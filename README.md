DKsort Manuscript Code
======================

This repository contains all of the code related to the DKsort project manuscript. The code is contained within several IPython notebooks that will perform the main analyses and generate all figures used in the manuscript.

Authors
-------

- Michael L. Waskom
- Dharshan Kumaran
- Alan M. Gordon
- Jesse Rissman
- Anthony D. Wagner

Preprocessing
-------------

Two processing steps were performed outside the scope of the notebooks. First,
the anatomical image for each subject was processed using Freesurfer 5.3 to
generate the cortical surface models. Specifically, the following command line
was used for each subject:

    recon-all -s $subject -all -3T

Additionally, the functional data were preproccesed with FSL 5.0, Freesufer
5.3, and Nipype 0.9 using [lyman](http://stanford.edu/~mwaskom/software/lyman).
[This commit](
https://github.com/mwaskom/lyman/commit/8c51fdf02350e27057713165fbb05b90b6cedc69)
of the lyman repository should correspond with the data in these notebooks. The
processing used the experiment parameters in the `dksort.py` file included in
this repository and was performed with the following command line:

    run_fmri.py -s subjects.txt -w preproc reg -t -reg epi -unsmoothed

Once those commands have been executed, every analysis can be generated using
these notebooks.

Analysis Notebooks
------------------

To reproduce the analyses in the manuscript, the notebooks should be executed
in the following order.

### Mask_Generation.ipynb

Using the label files in `roi/`, warp the ROIs from group space to individual
subject sufaces and write binary masks in functional space.

### Event_Info_Generation.ipynb

Read the `.mat` files generated by PsychToolBox and create

1. a master `.csv` file with behavioral and design information and

2. specific event files for the decoding analyses.

### Main_Analysis.ipynb

All of the actual analyses are contained within this notebook.

### ROI_Figure.ipynb

This notebook generates the ROI figure in the manuscript. Unlike the other
notebooks, it requires [PySurfer](http://pysurfer.github.io).

Other Data
----------

### rois/

Freesurfer `.label` files defining the ROIs in common surface space. These
labels were created from files distributed by
[Freesurfer](http://ftp.nmr.mgh.harvard.edu/fswiki/CorticalParcellation_Yeo2011).

### figures/

Figures that are output by these notebooks.

### project.py

The lyman project file that was used to process the data.

### dksort.py

The lyman experiment file for preprocessing the fMRI data.

### subjects.txt

The subject codes used in the processing.

License 
-------

The code in this notebook is under a revised BSD license. Other content is
currently covered by a Creative Commons Attribution license (CC BY), pending
final publication.

If you have access to this repository pre-publication, please do not distribute
without permission from the authors.
