DKsort Manuscript Code
======================

This repository contains all of the code related to the DKsort project manuscript. The code is contained within several IPython notebooks that will perform the main analyses and generate all figures used in the manuscript.

Authors
-------

- Michael L. Waskom
- Dharshan Kumaran
- Alan M. Gordon
- Jesse Rissman
- Anthony D. Wagner

Preprocessing
-------------

Two processing steps were performed outside the scope of this code. First,
the anatomical image for each subject was processed using Freesurfer 5.1 to
generate the cortical surface models. Specifically, the following command line was used for each subject:

    recon-all -s $subject -all -nuintensitycor-3T

Additionally, the functional data were preproccesed with FSL 4.1 and Freesufer 5.1 tools using lyman, which contains my fMRI workflows as implemented in Nipype. Specifically, [this commit](https://github.com/mwaskom/lyman/tree/dfe0512bda2098dc8aeb0cda3542ee6698e7df58) of the lyman repository was used. The processing used the experiment parameters in the `dksort.py` file included in this repository and was performed with the following command line:

    run_fmri.py -s subjects.txt -w preproc reg -t -reg epi -unsmoothed

Once those commands have been executed, every analysis can be generated using these notebooks.

Analysis Notebooks
------------------

To reproduce the analyses in the manuscript, the notebooks should be executed in the following order.

### Mask_Generation.ipynb

Using the label files in `roi/`, warp the ROIs from group space to individual subject sufaces and write binary masks in functional space.

### Event_Info_Generation.ipynb

Read the `.mat` files generated by PsychToolBox and create a) a master `.csv` file with behavioral and design information and b) specific event files for the decoding analyses.

### DKsort_Neuron.ipynb

All of the actual analyses are contained within this notebook.

### ROI_Figure.ipynb

This notebook generates the ROI figure in the manuscript. It is separate because it needs to be run in an environment that supports wxPython (i.e. 32 bit on OSX).

Other Data
----------

### rois/

Freesurfer `.label` files defining the ROIs in common surface space. These labels were created from files distributed by [Freesurfer](http://ftp.nmr.mgh.harvard.edu/fswiki/CorticalParcellation_Yeo2011).

### figures/

Figures that are output by these notebooks.

### subjects.txt

The subject codes used in the processing.

### dksort.py

The lyman experiment file for preprocessing the fMRI data.

License 
-------

The code in this notebook is under a revised BSD license. Other content is currently covered by a Creative Commons Attribution-ShareAlike 3.0 Unported license, pending final publication.

If you have access to this repository pre-publication, please do not distribute without permission from the authors.
